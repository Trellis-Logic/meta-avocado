header:
  version: 11

repos:
  meta-tegra:
    url: https://github.com/trellis-logic/meta-tegra
    branch: scarthgap-l4t-r35.x
    layers:
      .:

  meta-tegra-community:
    url: https://github.com/oe4t/meta-tegra-community
    branch: scarthgap-l4t-r35.x

  meta-swupdate:
    url: https://github.com/sbabic/meta-swupdate
    branch: master

local_conf_header:
  tegra: |
    UBOOT_EXTLINUX = "1"
    USE_REDUNDANT_FLASH_LAYOUT_DEFAULT = "1"
    INITRAMFS_IMAGE_BUNDLE = "1"
    FWUP_EXTRA_VARS = "TEGRAFLASH_HOST_PATH INITRAMFS_IMAGE"
    TEGRAFLASH_HOST_PATH = "${COMPONENTS_DIR}/${MACHINE_ARCH}/tegra-bootfiles/usr/share/tegraflash"
    TEGRA_INITRD_FLASH_INITRAMFS_FSTYPES = "cpio.gz.cboot"
    CORE_IMAGE_EXTRA_INSTALL:append = " packagegroup-avocado-tegra"
    DISTRO_FEATURES_EXTRA += "opengl seccomp"
    CUDA_GCCVERSION = "8.%"
    LICENSE_FLAGS_ACCEPTED:append = " commercial_faad2 commercial_x264"

  deepstream-demo: |
    CORE_IMAGE_EXTRA_INSTALL:append = " deepstream-6.3-pyds-nvdsanalytics-demo"
    # Remove 'blank' packageconfig from
    # https://github.com/yoctoproject/poky/blob/e575d02196b0013c25f8064e4dbe3fc2a0ef72d0/meta/recipes-graphics/x11-common/xserver-nodm-init_3.0.bb#L25
    # to avoid screen blanking
    PACKAGECONFIG:remove:pn-xserver-nodm-init = "blank"

  swupdate-tegra: |
    IMAGE_INSTALL:append = " swupdate"
    IMAGE_FSTYPES:append = " tar.gz"
    SWUPDATE_CORE_IMAGE_NAME ?= "avocado-image-base"

target:
  swupdate-image-tegra
